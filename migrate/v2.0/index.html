
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://jippi.github.io/docker-pixelfed/migrate/v2.0/">
      
      
        <link rel="prev" href="../../customize/templating/">
      
      
        <link rel="next" href="../v3.0/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.33">
    
    
      
        <title>v2 (pixelfed/pixelfed) - Docker Pixelfed</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="v2 (pixelfed/pixelfed) - Docker Pixelfed" >
      
        <meta  property="og:description"  content="None" >
      
        <meta  property="og:image"  content="https://jippi.github.io/docker-pixelfed/assets/images/social/migrate/v2.0.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://jippi.github.io/docker-pixelfed/migrate/v2.0/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="v2 (pixelfed/pixelfed) - Docker Pixelfed" >
      
        <meta  name="twitter:description"  content="None" >
      
        <meta  name="twitter:image"  content="https://jippi.github.io/docker-pixelfed/assets/images/social/migrate/v2.0.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#v2-pixelfedpixelfed" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Docker Pixelfed" class="md-header__button md-logo" aria-label="Docker Pixelfed" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Docker Pixelfed
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              v2 (pixelfed/pixelfed)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8v2m9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.71-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5M7 15a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/jippi/docker-pixelfed" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    jippi/docker-pixelfed
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Docker Pixelfed" class="md-nav__button md-logo" aria-label="Docker Pixelfed" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Docker Pixelfed
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/jippi/docker-pixelfed" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    jippi/docker-pixelfed
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../conventions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conventions
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Installation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Installation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/prerequisites/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prerequisites
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Guide
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Customize
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Customize
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../customize/settings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    .env settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../customize/tags/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker and Pixelfed versions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../customize/entrypoint/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Entrypoint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../customize/faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../customize/build-settings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Build settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../customize/runtimes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Runtimes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../customize/templating/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Templating
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Migrate
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Migrate
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    v2 (pixelfed/pixelfed)
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    v2 (pixelfed/pixelfed)
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#breaking-changes" class="md-nav__link">
    <span class="md-ellipsis">
      Breaking Changes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Breaking Changes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#breaking-change-new-dockerfile" class="md-nav__link">
    <span class="md-ellipsis">
      New Dockerfile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#breaking-change-new-docker-compose-file" class="md-nav__link">
    <span class="md-ellipsis">
      New Docker Compose file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#breaking-change-new-env-envdocker-file" class="md-nav__link">
    <span class="md-ellipsis">
      New .env / .env.docker file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#breaking-change-using-bind-volumes" class="md-nav__link">
    <span class="md-ellipsis">
      "Using
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#breaking-change-no-docker-networks" class="md-nav__link">
    <span class="md-ellipsis">
      No Docker networks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changes-needing-attention" class="md-nav__link">
    <span class="md-ellipsis">
      Changes needing attention
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Changes needing attention">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requires-attention-new-redis-version" class="md-nav__link">
    <span class="md-ellipsis">
      New Redis version
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requires-attention-pinned-mariadb-version" class="md-nav__link">
    <span class="md-ellipsis">
      Pinned MariaDB version
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requires-attention-automatic-one-time-setup-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      One-time setup tasks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#new-or-improved-features" class="md-nav__link">
    <span class="md-ellipsis">
      New or improved features
    </span>
  </a>
  
    <nav class="md-nav" aria-label="New or improved features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#improvement-nginx-proxy-service" class="md-nav__link">
    <span class="md-ellipsis">
      Nginx Proxy service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improvement-letsencryptacme-service" class="md-nav__link">
    <span class="md-ellipsis">
      LetsEncrypt/ACME service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improvement-automatic-run-of-one-time-setup-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      Automatic run of 'One-time setup' tasks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improvement-extensive-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      Extensive documentation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improvement-automatic-publishing-of-docker-images" class="md-nav__link">
    <span class="md-ellipsis">
      Automatic publishing of Docker images
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improvement-customizable-dockerfile" class="md-nav__link">
    <span class="md-ellipsis">
      Customizable Dockerfile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improvement-customizable-entrypoint" class="md-nav__link">
    <span class="md-ellipsis">
      Customizable ENTRYPOINT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improvement-templating-files" class="md-nav__link">
    <span class="md-ellipsis">
      Templating files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improvement-automatic-phpweb-server-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Automatic PHP/Web server configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improvement-permission-auto-fixing" class="md-nav__link">
    <span class="md-ellipsis">
      Permission auto-fixing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improvement-faster-docker-image-building" class="md-nav__link">
    <span class="md-ellipsis">
      Faster Docker image building
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improvement-fork-friendly-docker-releasing" class="md-nav__link">
    <span class="md-ellipsis">
      Fork friendly Docker releasing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migration-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Migration steps
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Migration steps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-backup" class="md-nav__link">
    <span class="md-ellipsis">
      1) Backup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-migrate-env-file" class="md-nav__link">
    <span class="md-ellipsis">
      2) Migrate .env file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-stop-containers" class="md-nav__link">
    <span class="md-ellipsis">
      3) Stop containers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-update-source-code" class="md-nav__link">
    <span class="md-ellipsis">
      4) Update source code
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-migrate-data" class="md-nav__link">
    <span class="md-ellipsis">
      5) Migrate data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5) Migrate data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-anonymous-volumes" class="md-nav__link">
    <span class="md-ellipsis">
      A) Anonymous volumes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="A) Anonymous volumes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a1-run-migration-container" class="md-nav__link">
    <span class="md-ellipsis">
      A1) Run migration container
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a2-check-old-folders" class="md-nav__link">
    <span class="md-ellipsis">
      A2) Check old folders
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a3-check-new-folders" class="md-nav__link">
    <span class="md-ellipsis">
      A3) Check new folders
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a4-copy-data" class="md-nav__link">
    <span class="md-ellipsis">
      A4) Copy data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a5-sanity-checking" class="md-nav__link">
    <span class="md-ellipsis">
      A5) Sanity checking
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-bindhost-volumes" class="md-nav__link">
    <span class="md-ellipsis">
      B) Bind/Host volumes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-start-containers" class="md-nav__link">
    <span class="md-ellipsis">
      6) Start containers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6) Start containers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-database" class="md-nav__link">
    <span class="md-ellipsis">
      The Database
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redis" class="md-nav__link">
    <span class="md-ellipsis">
      Redis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#worker" class="md-nav__link">
    <span class="md-ellipsis">
      Worker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web" class="md-nav__link">
    <span class="md-ellipsis">
      Web
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-verify" class="md-nav__link">
    <span class="md-ellipsis">
      7) Verify
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      8) Cleanup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rollback" class="md-nav__link">
    <span class="md-ellipsis">
      Rollback
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rollback">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#move-docker-composeyml-back" class="md-nav__link">
    <span class="md-ellipsis">
      Move docker-compose.yml back
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#move-env-file-back" class="md-nav__link">
    <span class="md-ellipsis">
      Move .env file back
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#go-back-to-the-old-source-code-version" class="md-nav__link">
    <span class="md-ellipsis">
      Go back to the old source code version
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-things-back-up" class="md-nav__link">
    <span class="md-ellipsis">
      Start things back up
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify-it-worked" class="md-nav__link">
    <span class="md-ellipsis">
      Verify it worked
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../v3.0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    v3 (jippi/docker-pixelfed)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#breaking-changes" class="md-nav__link">
    <span class="md-ellipsis">
      Breaking Changes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Breaking Changes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#breaking-change-new-dockerfile" class="md-nav__link">
    <span class="md-ellipsis">
      New Dockerfile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#breaking-change-new-docker-compose-file" class="md-nav__link">
    <span class="md-ellipsis">
      New Docker Compose file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#breaking-change-new-env-envdocker-file" class="md-nav__link">
    <span class="md-ellipsis">
      New .env / .env.docker file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#breaking-change-using-bind-volumes" class="md-nav__link">
    <span class="md-ellipsis">
      "Using
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#breaking-change-no-docker-networks" class="md-nav__link">
    <span class="md-ellipsis">
      No Docker networks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changes-needing-attention" class="md-nav__link">
    <span class="md-ellipsis">
      Changes needing attention
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Changes needing attention">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requires-attention-new-redis-version" class="md-nav__link">
    <span class="md-ellipsis">
      New Redis version
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requires-attention-pinned-mariadb-version" class="md-nav__link">
    <span class="md-ellipsis">
      Pinned MariaDB version
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requires-attention-automatic-one-time-setup-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      One-time setup tasks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#new-or-improved-features" class="md-nav__link">
    <span class="md-ellipsis">
      New or improved features
    </span>
  </a>
  
    <nav class="md-nav" aria-label="New or improved features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#improvement-nginx-proxy-service" class="md-nav__link">
    <span class="md-ellipsis">
      Nginx Proxy service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improvement-letsencryptacme-service" class="md-nav__link">
    <span class="md-ellipsis">
      LetsEncrypt/ACME service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improvement-automatic-run-of-one-time-setup-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      Automatic run of 'One-time setup' tasks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improvement-extensive-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      Extensive documentation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improvement-automatic-publishing-of-docker-images" class="md-nav__link">
    <span class="md-ellipsis">
      Automatic publishing of Docker images
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improvement-customizable-dockerfile" class="md-nav__link">
    <span class="md-ellipsis">
      Customizable Dockerfile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improvement-customizable-entrypoint" class="md-nav__link">
    <span class="md-ellipsis">
      Customizable ENTRYPOINT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improvement-templating-files" class="md-nav__link">
    <span class="md-ellipsis">
      Templating files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improvement-automatic-phpweb-server-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Automatic PHP/Web server configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improvement-permission-auto-fixing" class="md-nav__link">
    <span class="md-ellipsis">
      Permission auto-fixing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improvement-faster-docker-image-building" class="md-nav__link">
    <span class="md-ellipsis">
      Faster Docker image building
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improvement-fork-friendly-docker-releasing" class="md-nav__link">
    <span class="md-ellipsis">
      Fork friendly Docker releasing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migration-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Migration steps
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Migration steps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-backup" class="md-nav__link">
    <span class="md-ellipsis">
      1) Backup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-migrate-env-file" class="md-nav__link">
    <span class="md-ellipsis">
      2) Migrate .env file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-stop-containers" class="md-nav__link">
    <span class="md-ellipsis">
      3) Stop containers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-update-source-code" class="md-nav__link">
    <span class="md-ellipsis">
      4) Update source code
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-migrate-data" class="md-nav__link">
    <span class="md-ellipsis">
      5) Migrate data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5) Migrate data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-anonymous-volumes" class="md-nav__link">
    <span class="md-ellipsis">
      A) Anonymous volumes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="A) Anonymous volumes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a1-run-migration-container" class="md-nav__link">
    <span class="md-ellipsis">
      A1) Run migration container
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a2-check-old-folders" class="md-nav__link">
    <span class="md-ellipsis">
      A2) Check old folders
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a3-check-new-folders" class="md-nav__link">
    <span class="md-ellipsis">
      A3) Check new folders
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a4-copy-data" class="md-nav__link">
    <span class="md-ellipsis">
      A4) Copy data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a5-sanity-checking" class="md-nav__link">
    <span class="md-ellipsis">
      A5) Sanity checking
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-bindhost-volumes" class="md-nav__link">
    <span class="md-ellipsis">
      B) Bind/Host volumes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-start-containers" class="md-nav__link">
    <span class="md-ellipsis">
      6) Start containers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6) Start containers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-database" class="md-nav__link">
    <span class="md-ellipsis">
      The Database
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redis" class="md-nav__link">
    <span class="md-ellipsis">
      Redis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#worker" class="md-nav__link">
    <span class="md-ellipsis">
      Worker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web" class="md-nav__link">
    <span class="md-ellipsis">
      Web
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-verify" class="md-nav__link">
    <span class="md-ellipsis">
      7) Verify
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      8) Cleanup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rollback" class="md-nav__link">
    <span class="md-ellipsis">
      Rollback
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rollback">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#move-docker-composeyml-back" class="md-nav__link">
    <span class="md-ellipsis">
      Move docker-compose.yml back
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#move-env-file-back" class="md-nav__link">
    <span class="md-ellipsis">
      Move .env file back
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#go-back-to-the-old-source-code-version" class="md-nav__link">
    <span class="md-ellipsis">
      Go back to the old source code version
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-things-back-up" class="md-nav__link">
    <span class="md-ellipsis">
      Start things back up
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify-it-worked" class="md-nav__link">
    <span class="md-ellipsis">
      Verify it worked
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/jippi/docker-pixelfed/edit/main/docs/migrate/v2.0.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/jippi/docker-pixelfed/raw/main/docs/migrate/v2.0.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg>
    </a>
  


<h1 id="v2-pixelfedpixelfed">v2 (pixelfed/pixelfed)<a class="headerlink" href="#v2-pixelfedpixelfed" title="Permanent link">&para;</a></h1>
<div class="admonition abstract">
<p class="admonition-title">This document assuming you want to upgrade the upstream <abbr title="Docker Compose is a tool for defining and running multi-container applications. It is the key to unlocking a streamlined and efficient development and deployment experience">Docker Compose</abbr> v2 setup!</p>
</div>
<p>There are <a href="https://github.com/pixelfed/pixelfed/pull/4844"><em>a lot</em> of changes</a> in how Pixelfed <abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr>/<abbr title="Docker Compose is a tool for defining and running multi-container applications. It is the key to unlocking a streamlined and efficient development and deployment experience">Docker Compose</abbr> images work - it's a complete rewrite - with a couple of breaking/significant changes.</p>
<p>But don't worry! This document and the <a href="#migration-steps">Migration Guide</a> further down covers all of the required changes and steps you need to safely migrate.</p>
<p>We don't take <em>breaking changes</em> or <em>lengthy migration guides</em> lightly, and future iterations and improvements will be either seamless or <em>much</em> smaller in scope and complexity.</p>
<p>We do however believe that the <em>many</em> improvements (listed below) are worth it, and sets us up for a brighter future for self-hosted and maintainable Pixelfed servers</p>
<h2 id="breaking-changes">Breaking Changes<a class="headerlink" href="#breaking-changes" title="Permanent link">&para;</a></h2>
<div class="admonition danger">
<p class="admonition-title">These changes are breaking, removing, or changing existing behavior from <abbr title="Docker Compose is a tool for defining and running multi-container applications. It is the key to unlocking a streamlined and efficient development and deployment experience">Docker Compose</abbr> v1 and <em>requires</em> your attention and possibly some steps to fix. The <a href="#migration-steps">Migration Guide</a> has step by step guide for most of these!</p>
</div>
<h3 id="breaking-change-new-dockerfile"><span class="mdx-badge mdx-badge--danger"><span class="mdx-badge__icon"><a href="../../conventions/" title="Breaking Change"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11 15H6l7-14v8h5l-7 14v-8Z"/></svg></span></a></span><span class="mdx-badge__text">Breaking Change</span></span> New <code>Dockerfile</code><a class="headerlink" href="#breaking-change-new-dockerfile" title="Permanent link">&para;</a></h3>
<p>All <a href="../../customize/runtimes/"><abbr title="The webserver used inside the Pixelfed container (Apache / Nginx).">runtime</abbr> variations</a> of Pixelfed on <abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr> are now build from a single <code>Dockerfile</code>, rather than the previously three.</p>
<p>Please see the <a href="../../customize/runtimes/"><abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr> Runtimes</a> and <a href="../../customize/entrypoint/"><abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr> Customization</a> documentation for more information.</p>
<h3 id="breaking-change-new-docker-compose-file"><span class="mdx-badge mdx-badge--danger"><span class="mdx-badge__icon"><a href="../../conventions/" title="Breaking Change"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11 15H6l7-14v8h5l-7 14v-8Z"/></svg></span></a></span><span class="mdx-badge__text">Breaking Change</span></span> New <abbr title="Docker Compose is a tool for defining and running multi-container applications. It is the key to unlocking a streamlined and efficient development and deployment experience">Docker Compose</abbr> file<a class="headerlink" href="#breaking-change-new-docker-compose-file" title="Permanent link">&para;</a></h3>
<p>The <code>docker-compose.yml</code> file has been rewritten from the ground up to be provide better defaults and more flexible out of the box.</p>
<p>This mean that <em>most</em> things you would likely want to tweak can be controlled from your <code>.env</code> config file, like installing additional APT Packages, <abbr title="PECL is a repository for PHP Extensions, providing a directory of all known extensions and hosting facilities for downloading and development of PHP extensions">PECL</abbr>/<abbr title="The programming language Pixelfed is written in">PHP</abbr> extensions, changing <abbr title="The programming language Pixelfed is written in">PHP</abbr> version, modifying <abbr title="The programming language Pixelfed is written in">PHP</abbr> settings (such as <code>memory_limit</code>), disabling specific services, changing where data and config files are stored, and so on.</p>
<h3 id="breaking-change-new-env-envdocker-file"><span class="mdx-badge mdx-badge--danger"><span class="mdx-badge__icon"><a href="../../conventions/" title="Breaking Change"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11 15H6l7-14v8h5l-7 14v-8Z"/></svg></span></a></span><span class="mdx-badge__text">Breaking Change</span></span> New <code>.env</code> / <code>.env.docker</code> file<a class="headerlink" href="#breaking-change-new-env-envdocker-file" title="Permanent link">&para;</a></h3>
<p>The starter <code>.env.docker</code> file has been <em>significantly</em> expanded with most of the Pixelfed settings available, along with many <abbr title="Docker Compose is a tool for defining and running multi-container applications. It is the key to unlocking a streamlined and efficient development and deployment experience">Docker Compose</abbr> specific ones.</p>
<p>Your Pixelfed specific settings are (of course) unchanged, but you need to configure them again after copying the new <code>.env.docker</code> file.</p>
<h3 bind="bind" id="breaking-change-using-bind-volumes" volumes="volumes"><span class="mdx-badge mdx-badge--danger"><span class="mdx-badge__icon"><a href="../../conventions/" title="Breaking Change"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11 15H6l7-14v8h5l-7 14v-8Z"/></svg></span></a></span><span class="mdx-badge__text">Breaking Change</span></span> Using <code>bind</code> volumes<a class="headerlink" href="#breaking-change-using-bind-volumes" title="Permanent link">&para;</a></h3>
<p>The old <code>docker-compose.yml</code> configuration file <a href="https://github.com/pixelfed/pixelfed/blob/b1ff44ca2f75c088a11576fb03b5bad2fbed4d5c/docker-compose.yml#L72-L76">declared four anonymous <abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr> volumes</a> for storing Pixelfed related data within.</p>
<p>These are no longer used, instead favoring a <a href="https://docs.docker.com/storage/bind-mounts/"><abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr> bind volume</a> approach where content is stored directly on the server disk, outside
of a <abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr> volume.</p>
<p>The consequence of this change is that <em>all</em> data stored in the - now unsupported - <abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr> volumes will no longer be accessible by Pixelfed.</p>
<ul>
<li>The <code>db-data</code> volume <em>definitely</em> contains important data - it's your database, after all!</li>
<li>The <code>app-storage</code> volume <em>definitely</em> contains important data - it's files uploaded to - or seen by - your server!</li>
<li>The <code>redis-data</code> volume <em>might</em> contain important data (depending on your configuration)</li>
<li>The <code>app-bootstrap</code> volume does not contain any important data - all of it will be generated automatically in the new setup on startup. We will <em>not</em> be migrating this!</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Please see the <a href="#migration-steps">Migration steps</a> section for information on moving your data.</p>
</div>
<h3 id="breaking-change-no-docker-networks"><span class="mdx-badge mdx-badge--danger"><span class="mdx-badge__icon"><a href="../../conventions/" title="Breaking Change"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11 15H6l7-14v8h5l-7 14v-8Z"/></svg></span></a></span><span class="mdx-badge__text">Breaking Change</span></span> No <abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr> networks<a class="headerlink" href="#breaking-change-no-docker-networks" title="Permanent link">&para;</a></h3>
<p>The <code>docker-compose.yml</code> no longer include any custom networks, instead favoring the simplicity of the default <code>bridge</code> network.</p>
<p>The published ports can be configured via your <code>.env</code> file, look for the <code>DOCKER_*_HOST_PORT</code> keys.</p>
<h2 id="changes-needing-attention">Changes needing attention<a class="headerlink" href="#changes-needing-attention" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">These changes are mostly informational and unlikely to cause any issues during upgrade, but included for visibility and in case your specific set up require them to be changed.</p>
</div>
<h3 id="requires-attention-new-redis-version"><span class="mdx-badge mdx-badge--attention"><span class="mdx-badge__icon"><a href="../../conventions/" title="Requires Attention"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14h-2V9h2m0 9h-2v-2h2M1 21h22L12 2 1 21Z"/></svg></span></a></span><span class="mdx-badge__text">Requires Attention</span></span> New Redis version<a class="headerlink" href="#requires-attention-new-redis-version" title="Permanent link">&para;</a></h3>
<p>Redis has been upgraded from using the last version <code>5</code> release to using the latest <code>7.2</code> version instead - favoring the <code>debian</code> variant instead of <code>alpine</code>.</p>
<p>The Redis version can be controlled in your <code>.env</code> file via <code>DOCKER_REDIS_VERSION</code>.</p>
<p>If you want to keep using the Redis version set <code>DOCKER_REDIS_VERSION="5-alpine"</code> in your <code>.env</code> file.</p>
<p>If you want to use <code>7.2</code> but the alpine variant, simply append <code>-alpine</code> to the <code>DOCKER_REDIS_VERSION</code> (e.g. <code>DOCKER_REDIS_VERSION=7.2-alpine</code>).</p>
<h3 id="requires-attention-pinned-mariadb-version"><span class="mdx-badge mdx-badge--attention"><span class="mdx-badge__icon"><a href="../../conventions/" title="Requires Attention"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14h-2V9h2m0 9h-2v-2h2M1 21h22L12 2 1 21Z"/></svg></span></a></span><span class="mdx-badge__text">Requires Attention</span></span> Pinned MariaDB version<a class="headerlink" href="#requires-attention-pinned-mariadb-version" title="Permanent link">&para;</a></h3>
<p>The included <code>db</code> service is now pinned to MariaDB <code>11.2</code> instead of <code>latest</code>.</p>
<p>You can revert to the previous setting by setting <code>DB_VERSION="latest"</code> in your <code>.env</code> file.</p>
<h3 id="requires-attention-automatic-one-time-setup-tasks"><span class="mdx-badge mdx-badge--attention"><span class="mdx-badge__icon"><a href="../../conventions/" title="Requires Attention"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14h-2V9h2m0 9h-2v-2h2M1 21h22L12 2 1 21Z"/></svg></span></a></span><span class="mdx-badge__text">Requires Attention</span></span> Automatic "One-time setup tasks"<a class="headerlink" href="#requires-attention-automatic-one-time-setup-tasks" title="Permanent link">&para;</a></h3>
<p>This is also covered in the <a href="#migration-steps">migration guide</a> but existing Pixelfed instances need to disable the automatic run of <a href="https://docs.pixelfed.org/running-pixelfed/installation.html#one-time-setup-tasks">One-time setup tasks</a> by setting <code>DOCKER_APP_RUN_ONE_TIME_SETUP_TASKS=0</code> in your <code>.env</code> file.</p>
<p>Your container <em>will</em> fail to start up if these are already configured for your site.</p>
<h2 id="new-or-improved-features">New or improved features<a class="headerlink" href="#new-or-improved-features" title="Permanent link">&para;</a></h2>
<div class="admonition tip">
<p class="admonition-title">All the new and exciting features and capabilities. <img alt="" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f680.svg" title=":rocket:" /></p>
<p>This is where we hope we can convince you that the breaking changes and migration work was worth it <img alt="" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/2764.svg" title=":heart:" /></p>
</div>
<h3 id="improvement-nginx-proxy-service"><span class="mdx-badge mdx-badge--improvement"><span class="mdx-badge__icon"><a href="../../conventions/" title="Improvement"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17.66 11.2c-.23-.3-.51-.56-.77-.82-.67-.6-1.43-1.03-2.07-1.66C13.33 7.26 13 4.85 13.95 3c-.95.23-1.78.75-2.49 1.32-2.59 2.08-3.61 5.75-2.39 8.9.04.1.08.2.08.33 0 .22-.15.42-.35.5-.23.1-.47.04-.66-.12a.58.58 0 0 1-.14-.17c-1.13-1.43-1.31-3.48-.55-5.12C5.78 10 4.87 12.3 5 14.47c.06.5.12 1 .29 1.5.14.6.41 1.2.71 1.73 1.08 1.73 2.95 2.97 4.96 3.22 2.14.27 4.43-.12 6.07-1.6 1.83-1.66 2.47-4.32 1.53-6.6l-.13-.26c-.21-.46-.77-1.26-.77-1.26m-3.16 6.3c-.28.24-.74.5-1.1.6-1.12.4-2.24-.16-2.9-.82 1.19-.28 1.9-1.16 2.11-2.05.17-.8-.15-1.46-.28-2.23-.12-.74-.1-1.37.17-2.06.19.38.39.76.63 1.06.77 1 1.98 1.44 2.24 2.8.04.14.06.28.06.43.03.82-.33 1.72-.93 2.27Z"/></svg></span></a></span><span class="mdx-badge__text">Improvement</span></span> <abbr title="Nginx is a web server that can also be used as a reverse proxy, load balancer, and HTTP cache.">Nginx</abbr> Proxy service<a class="headerlink" href="#improvement-nginx-proxy-service" title="Permanent link">&para;</a></h3>
<p>The new <code>docker-compose.yml</code> includes an <em>optional</em> (but enabled by default) <abbr title="Nginx is a web server that can also be used as a reverse proxy, load balancer, and HTTP cache.">Nginx</abbr> Proxy for SSL/TLS termination.</p>
<p>Please see <a href="../../customize/faq/#how-do-i-use-my-own-proxy-server"><code>How do I use my own Proxy server?</code></a> and <code>DOCKER_PROXY_*</code> keys in the <code>.env</code> file for more information.</p>
<h3 id="improvement-letsencryptacme-service"><span class="mdx-badge mdx-badge--improvement"><span class="mdx-badge__icon"><a href="../../conventions/" title="Improvement"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17.66 11.2c-.23-.3-.51-.56-.77-.82-.67-.6-1.43-1.03-2.07-1.66C13.33 7.26 13 4.85 13.95 3c-.95.23-1.78.75-2.49 1.32-2.59 2.08-3.61 5.75-2.39 8.9.04.1.08.2.08.33 0 .22-.15.42-.35.5-.23.1-.47.04-.66-.12a.58.58 0 0 1-.14-.17c-1.13-1.43-1.31-3.48-.55-5.12C5.78 10 4.87 12.3 5 14.47c.06.5.12 1 .29 1.5.14.6.41 1.2.71 1.73 1.08 1.73 2.95 2.97 4.96 3.22 2.14.27 4.43-.12 6.07-1.6 1.83-1.66 2.47-4.32 1.53-6.6l-.13-.26c-.21-.46-.77-1.26-.77-1.26m-3.16 6.3c-.28.24-.74.5-1.1.6-1.12.4-2.24-.16-2.9-.82 1.19-.28 1.9-1.16 2.11-2.05.17-.8-.15-1.46-.28-2.23-.12-.74-.1-1.37.17-2.06.19.38.39.76.63 1.06.77 1 1.98 1.44 2.24 2.8.04.14.06.28.06.43.03.82-.33 1.72-.93 2.27Z"/></svg></span></a></span><span class="mdx-badge__text">Improvement</span></span> LetsEncrypt/ACME service<a class="headerlink" href="#improvement-letsencryptacme-service" title="Permanent link">&para;</a></h3>
<p>The new <code>docker-compose.yml</code> includes an <em>optional</em> (but enabled by default) ACME/LetsEncrypt service that when combined with the new <abbr title="Nginx is a web server that can also be used as a reverse proxy, load balancer, and HTTP cache.">Nginx</abbr> Proxy automatically creates and maintains your SSL/TLS certificates.</p>
<p>Please see <a href="../../customize/faq/#how-do-i-use-my-own-ssl-certificate"><code>How do I use my own SSL certificate?</code></a> and <code>DOCKER_PROXY_*</code> + <code>LETSENCRYPT_*</code> keys in the <code>.env</code> file for more information.</p>
<h3 id="improvement-automatic-run-of-one-time-setup-tasks"><span class="mdx-badge mdx-badge--improvement"><span class="mdx-badge__icon"><a href="../../conventions/" title="Improvement"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17.66 11.2c-.23-.3-.51-.56-.77-.82-.67-.6-1.43-1.03-2.07-1.66C13.33 7.26 13 4.85 13.95 3c-.95.23-1.78.75-2.49 1.32-2.59 2.08-3.61 5.75-2.39 8.9.04.1.08.2.08.33 0 .22-.15.42-.35.5-.23.1-.47.04-.66-.12a.58.58 0 0 1-.14-.17c-1.13-1.43-1.31-3.48-.55-5.12C5.78 10 4.87 12.3 5 14.47c.06.5.12 1 .29 1.5.14.6.41 1.2.71 1.73 1.08 1.73 2.95 2.97 4.96 3.22 2.14.27 4.43-.12 6.07-1.6 1.83-1.66 2.47-4.32 1.53-6.6l-.13-.26c-.21-.46-.77-1.26-.77-1.26m-3.16 6.3c-.28.24-.74.5-1.1.6-1.12.4-2.24-.16-2.9-.82 1.19-.28 1.9-1.16 2.11-2.05.17-.8-.15-1.46-.28-2.23-.12-.74-.1-1.37.17-2.06.19.38.39.76.63 1.06.77 1 1.98 1.44 2.24 2.8.04.14.06.28.06.43.03.82-.33 1.72-.93 2.27Z"/></svg></span></a></span><span class="mdx-badge__text">Improvement</span></span> Automatic run of "One-time setup tasks"<a class="headerlink" href="#improvement-automatic-run-of-one-time-setup-tasks" title="Permanent link">&para;</a></h3>
<p>When you set up a new Pixelfed server, there is handful of commands you need to run once (and only once) - these are called <a href="https://docs.pixelfed.org/running-pixelfed/installation.html#one-time-setup-tasks">One-time setup tasks</a>.</p>
<p>These steps are now automatically run for you when <a href="../../installation/guide/">creating a new Pixelfed server</a>.</p>
<h3 id="improvement-extensive-documentation"><span class="mdx-badge mdx-badge--improvement"><span class="mdx-badge__icon"><a href="../../conventions/" title="Improvement"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17.66 11.2c-.23-.3-.51-.56-.77-.82-.67-.6-1.43-1.03-2.07-1.66C13.33 7.26 13 4.85 13.95 3c-.95.23-1.78.75-2.49 1.32-2.59 2.08-3.61 5.75-2.39 8.9.04.1.08.2.08.33 0 .22-.15.42-.35.5-.23.1-.47.04-.66-.12a.58.58 0 0 1-.14-.17c-1.13-1.43-1.31-3.48-.55-5.12C5.78 10 4.87 12.3 5 14.47c.06.5.12 1 .29 1.5.14.6.41 1.2.71 1.73 1.08 1.73 2.95 2.97 4.96 3.22 2.14.27 4.43-.12 6.07-1.6 1.83-1.66 2.47-4.32 1.53-6.6l-.13-.26c-.21-.46-.77-1.26-.77-1.26m-3.16 6.3c-.28.24-.74.5-1.1.6-1.12.4-2.24-.16-2.9-.82 1.19-.28 1.9-1.16 2.11-2.05.17-.8-.15-1.46-.28-2.23-.12-.74-.1-1.37.17-2.06.19.38.39.76.63 1.06.77 1 1.98 1.44 2.24 2.8.04.14.06.28.06.43.03.82-.33 1.72-.93 2.27Z"/></svg></span></a></span><span class="mdx-badge__text">Improvement</span></span> Extensive documentation<a class="headerlink" href="#improvement-extensive-documentation" title="Permanent link">&para;</a></h3>
<p>How to run and use the new <abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr> setup has been documented extensively. Not only on <em>this</em> page, but also in all the new scripts, <code>Dockerfile</code>, and <code>.env.docker</code> file.</p>
<p>We hope this will make it much easier to confidently and comfortably run your Pixelfed server with <abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr> - and when things <em>do</em> go wrong, the debugging and fixing of the issue much easier and quicker.</p>
<h3 id="improvement-automatic-publishing-of-docker-images"><span class="mdx-badge mdx-badge--improvement"><span class="mdx-badge__icon"><a href="../../conventions/" title="Improvement"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17.66 11.2c-.23-.3-.51-.56-.77-.82-.67-.6-1.43-1.03-2.07-1.66C13.33 7.26 13 4.85 13.95 3c-.95.23-1.78.75-2.49 1.32-2.59 2.08-3.61 5.75-2.39 8.9.04.1.08.2.08.33 0 .22-.15.42-.35.5-.23.1-.47.04-.66-.12a.58.58 0 0 1-.14-.17c-1.13-1.43-1.31-3.48-.55-5.12C5.78 10 4.87 12.3 5 14.47c.06.5.12 1 .29 1.5.14.6.41 1.2.71 1.73 1.08 1.73 2.95 2.97 4.96 3.22 2.14.27 4.43-.12 6.07-1.6 1.83-1.66 2.47-4.32 1.53-6.6l-.13-.26c-.21-.46-.77-1.26-.77-1.26m-3.16 6.3c-.28.24-.74.5-1.1.6-1.12.4-2.24-.16-2.9-.82 1.19-.28 1.9-1.16 2.11-2.05.17-.8-.15-1.46-.28-2.23-.12-.74-.1-1.37.17-2.06.19.38.39.76.63 1.06.77 1 1.98 1.44 2.24 2.8.04.14.06.28.06.43.03.82-.33 1.72-.93 2.27Z"/></svg></span></a></span><span class="mdx-badge__text">Improvement</span></span> Automatic publishing of <abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr> images<a class="headerlink" href="#improvement-automatic-publishing-of-docker-images" title="Permanent link">&para;</a></h3>
<p>Going forward we will automatically build and push <abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr> images for Pixelfed to both <a href="https://hub.docker.com/r/jippi/pixelfed"><abbr title="Docker Hub is the world's easiest way to create, manage, and deliver your team's container applications.">Docker Hub</abbr></a> and <a href="https://github.com/jippi/pixelfed/pkgs/container/pixelfed">GitHub Container Registry</a>.</p>
<p>We will automatically be pushing all combinations of <a href="../../customize/runtimes/">our supported <abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr> runtimes</a> and <abbr title="The programming language Pixelfed is written in">PHP</abbr> version (8.1, 8.2 and soon 8.3).</p>
<p>Further more, testing Pull Requests has never been easier, as we will also build and push <abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr> images for all Pull Requests with tag prefix <code>pr-{ID}</code> (e.x. <code>pixelfed/pixelfed:pr-4844-apache-8.2</code>).</p>
<p>You can control which Pixelfed release you use via the <code>DOCKER_APP_RELEASE</code> key/value pair in your <code>.env</code> file.</p>
<h3 id="improvement-customizable-dockerfile"><span class="mdx-badge mdx-badge--improvement"><span class="mdx-badge__icon"><a href="../../conventions/" title="Improvement"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17.66 11.2c-.23-.3-.51-.56-.77-.82-.67-.6-1.43-1.03-2.07-1.66C13.33 7.26 13 4.85 13.95 3c-.95.23-1.78.75-2.49 1.32-2.59 2.08-3.61 5.75-2.39 8.9.04.1.08.2.08.33 0 .22-.15.42-.35.5-.23.1-.47.04-.66-.12a.58.58 0 0 1-.14-.17c-1.13-1.43-1.31-3.48-.55-5.12C5.78 10 4.87 12.3 5 14.47c.06.5.12 1 .29 1.5.14.6.41 1.2.71 1.73 1.08 1.73 2.95 2.97 4.96 3.22 2.14.27 4.43-.12 6.07-1.6 1.83-1.66 2.47-4.32 1.53-6.6l-.13-.26c-.21-.46-.77-1.26-.77-1.26m-3.16 6.3c-.28.24-.74.5-1.1.6-1.12.4-2.24-.16-2.9-.82 1.19-.28 1.9-1.16 2.11-2.05.17-.8-.15-1.46-.28-2.23-.12-.74-.1-1.37.17-2.06.19.38.39.76.63 1.06.77 1 1.98 1.44 2.24 2.8.04.14.06.28.06.43.03.82-.33 1.72-.93 2.27Z"/></svg></span></a></span><span class="mdx-badge__text">Improvement</span></span> Customizable <code>Dockerfile</code><a class="headerlink" href="#improvement-customizable-dockerfile" title="Permanent link">&para;</a></h3>
<p>It's now possible to tweak many <abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr> related settings without copying or forking Pixelfed Dockerfile!</p>
<p>The new Dockerfile has many <a href="../../customize/build-settings/">Build Arguments</a> (e.g., <code>--build-arg</code>) allowing you to easily</p>
<ul>
<li><a href="../../customize/build-settings/#php_version">Change your <abbr title="The programming language Pixelfed is written in">PHP</abbr> version</a></li>
<li><a href="../../customize/build-settings/#php_pecl_extensions">Install extra <abbr title="PECL is a repository for PHP Extensions, providing a directory of all known extensions and hosting facilities for downloading and development of PHP extensions">PECL</abbr> extensions</a></li>
<li><a href="../../customize/build-settings/#php_extensions">Install extra <abbr title="The programming language Pixelfed is written in">PHP</abbr> extensions</a></li>
<li><a href="../../customize/build-settings/#apt_packages_extra">Install extra APT packages</a></li>
<li><a href="../../customize/build-settings/#php_debian_release">Change <abbr title="Debian is a free operating system that's among the most mature versions of Linux available">Debian</abbr> version</a></li>
</ul>
<p>All of these (and more) settings are controlled from your <code>.env</code> file, and you simply need to run <code>docker compose build</code> to build your own bespoke version of Pixelfed on your server!</p>
<h3 id="improvement-customizable-entrypoint"><span class="mdx-badge mdx-badge--improvement"><span class="mdx-badge__icon"><a href="../../conventions/" title="Improvement"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17.66 11.2c-.23-.3-.51-.56-.77-.82-.67-.6-1.43-1.03-2.07-1.66C13.33 7.26 13 4.85 13.95 3c-.95.23-1.78.75-2.49 1.32-2.59 2.08-3.61 5.75-2.39 8.9.04.1.08.2.08.33 0 .22-.15.42-.35.5-.23.1-.47.04-.66-.12a.58.58 0 0 1-.14-.17c-1.13-1.43-1.31-3.48-.55-5.12C5.78 10 4.87 12.3 5 14.47c.06.5.12 1 .29 1.5.14.6.41 1.2.71 1.73 1.08 1.73 2.95 2.97 4.96 3.22 2.14.27 4.43-.12 6.07-1.6 1.83-1.66 2.47-4.32 1.53-6.6l-.13-.26c-.21-.46-.77-1.26-.77-1.26m-3.16 6.3c-.28.24-.74.5-1.1.6-1.12.4-2.24-.16-2.9-.82 1.19-.28 1.9-1.16 2.11-2.05.17-.8-.15-1.46-.28-2.23-.12-.74-.1-1.37.17-2.06.19.38.39.76.63 1.06.77 1 1.98 1.44 2.24 2.8.04.14.06.28.06.43.03.82-.33 1.72-.93 2.27Z"/></svg></span></a></span><span class="mdx-badge__text">Improvement</span></span> Customizable <code>ENTRYPOINT</code><a class="headerlink" href="#improvement-customizable-entrypoint" title="Permanent link">&para;</a></h3>
<p>Do you want to <a href="../../customize/entrypoint/#run-script-on-startup-entrypoint">run a script on container start up?</a> Or perhaps to <a href="../../customize/entrypoint/#disabling-entrypoint-or-individual-scripts">disable a specific init script?</a> Or even <a href="../../customize/entrypoint/#disabling-entrypoint-or-individual-scripts">disable all of the init scripts?</a></p>
<p>Now you can! And like with all the other settings it's just a setting in your <code>.env</code> file!</p>
<h3 id="improvement-templating-files"><span class="mdx-badge mdx-badge--improvement"><span class="mdx-badge__icon"><a href="../../conventions/" title="Improvement"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17.66 11.2c-.23-.3-.51-.56-.77-.82-.67-.6-1.43-1.03-2.07-1.66C13.33 7.26 13 4.85 13.95 3c-.95.23-1.78.75-2.49 1.32-2.59 2.08-3.61 5.75-2.39 8.9.04.1.08.2.08.33 0 .22-.15.42-.35.5-.23.1-.47.04-.66-.12a.58.58 0 0 1-.14-.17c-1.13-1.43-1.31-3.48-.55-5.12C5.78 10 4.87 12.3 5 14.47c.06.5.12 1 .29 1.5.14.6.41 1.2.71 1.73 1.08 1.73 2.95 2.97 4.96 3.22 2.14.27 4.43-.12 6.07-1.6 1.83-1.66 2.47-4.32 1.53-6.6l-.13-.26c-.21-.46-.77-1.26-.77-1.26m-3.16 6.3c-.28.24-.74.5-1.1.6-1.12.4-2.24-.16-2.9-.82 1.19-.28 1.9-1.16 2.11-2.05.17-.8-.15-1.46-.28-2.23-.12-.74-.1-1.37.17-2.06.19.38.39.76.63 1.06.77 1 1.98 1.44 2.24 2.8.04.14.06.28.06.43.03.82-.33 1.72-.93 2.27Z"/></svg></span></a></span><span class="mdx-badge__text">Improvement</span></span> Templating files<a class="headerlink" href="#improvement-templating-files" title="Permanent link">&para;</a></h3>
<p>The new <code>ENTRYPOINT</code> system offers an <a href="../../customize/templating/">extensible and flexible way for you to template configuration files</a> such as your <code>php.ini</code> during container start up.</p>
<p>The templating system has access to all settings from your <code>.env</code> file, and you can <a href="../../customize/templating/#file-path-examples">easily add your own templates!</a></p>
<h3 id="improvement-automatic-phpweb-server-configuration"><span class="mdx-badge mdx-badge--improvement"><span class="mdx-badge__icon"><a href="../../conventions/" title="Improvement"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17.66 11.2c-.23-.3-.51-.56-.77-.82-.67-.6-1.43-1.03-2.07-1.66C13.33 7.26 13 4.85 13.95 3c-.95.23-1.78.75-2.49 1.32-2.59 2.08-3.61 5.75-2.39 8.9.04.1.08.2.08.33 0 .22-.15.42-.35.5-.23.1-.47.04-.66-.12a.58.58 0 0 1-.14-.17c-1.13-1.43-1.31-3.48-.55-5.12C5.78 10 4.87 12.3 5 14.47c.06.5.12 1 .29 1.5.14.6.41 1.2.71 1.73 1.08 1.73 2.95 2.97 4.96 3.22 2.14.27 4.43-.12 6.07-1.6 1.83-1.66 2.47-4.32 1.53-6.6l-.13-.26c-.21-.46-.77-1.26-.77-1.26m-3.16 6.3c-.28.24-.74.5-1.1.6-1.12.4-2.24-.16-2.9-.82 1.19-.28 1.9-1.16 2.11-2.05.17-.8-.15-1.46-.28-2.23-.12-.74-.1-1.37.17-2.06.19.38.39.76.63 1.06.77 1 1.98 1.44 2.24 2.8.04.14.06.28.06.43.03.82-.33 1.72-.93 2.27Z"/></svg></span></a></span><span class="mdx-badge__text">Improvement</span></span> Automatic <abbr title="The programming language Pixelfed is written in">PHP</abbr>/Web server configuration<a class="headerlink" href="#improvement-automatic-phpweb-server-configuration" title="Permanent link">&para;</a></h3>
<p>Thanks to the new <a href="../../customize/templating/">templating system</a> we now automatically calculate and configure required <abbr title="The programming language Pixelfed is written in">PHP</abbr> / Web server settings for you - using your <code>.env</code> settings - such as</p>
<ul>
<li>(php.ini) <code>upload_max_filesize</code> with this formula <code>(MAX_PHOTO_SIZE * MAX_ALBUM_LENGTH) + BUFFER</code></li>
<li>(php.ini) <code>post_max_size</code> with this formula <code>(MAX_PHOTO_SIZE * MAX_ALBUM_LENGTH) + BUFFER</code></li>
<li>(php.ini) <code>max_file_uploads</code> using <code>MAX_ALBUM_LENGTH</code></li>
<li>(php.ini) <code>memory_limit</code> using <code>PHP_MEMORY_LIMIT</code></li>
<li>(php.ini) <code>[Date]date.timezone</code> using <code>APP_TIMEZONE</code></li>
</ul>
<h3 id="improvement-permission-auto-fixing"><span class="mdx-badge mdx-badge--improvement"><span class="mdx-badge__icon"><a href="../../conventions/" title="Improvement"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17.66 11.2c-.23-.3-.51-.56-.77-.82-.67-.6-1.43-1.03-2.07-1.66C13.33 7.26 13 4.85 13.95 3c-.95.23-1.78.75-2.49 1.32-2.59 2.08-3.61 5.75-2.39 8.9.04.1.08.2.08.33 0 .22-.15.42-.35.5-.23.1-.47.04-.66-.12a.58.58 0 0 1-.14-.17c-1.13-1.43-1.31-3.48-.55-5.12C5.78 10 4.87 12.3 5 14.47c.06.5.12 1 .29 1.5.14.6.41 1.2.71 1.73 1.08 1.73 2.95 2.97 4.96 3.22 2.14.27 4.43-.12 6.07-1.6 1.83-1.66 2.47-4.32 1.53-6.6l-.13-.26c-.21-.46-.77-1.26-.77-1.26m-3.16 6.3c-.28.24-.74.5-1.1.6-1.12.4-2.24-.16-2.9-.82 1.19-.28 1.9-1.16 2.11-2.05.17-.8-.15-1.46-.28-2.23-.12-.74-.1-1.37.17-2.06.19.38.39.76.63 1.06.77 1 1.98 1.44 2.24 2.8.04.14.06.28.06.43.03.82-.33 1.72-.93 2.27Z"/></svg></span></a></span><span class="mdx-badge__text">Improvement</span></span> Permission auto-fixing<a class="headerlink" href="#improvement-permission-auto-fixing" title="Permanent link">&para;</a></h3>
<p>If your installation for some reason has issues with permissions to files/directories, you can now automatically <a href="../../customize/entrypoint/#fixing-ownership-on-startup">fix ownership and permissions on start up</a>.</p>
<p>This is an opt-in feature.</p>
<h3 id="improvement-faster-docker-image-building"><span class="mdx-badge mdx-badge--improvement"><span class="mdx-badge__icon"><a href="../../conventions/" title="Improvement"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17.66 11.2c-.23-.3-.51-.56-.77-.82-.67-.6-1.43-1.03-2.07-1.66C13.33 7.26 13 4.85 13.95 3c-.95.23-1.78.75-2.49 1.32-2.59 2.08-3.61 5.75-2.39 8.9.04.1.08.2.08.33 0 .22-.15.42-.35.5-.23.1-.47.04-.66-.12a.58.58 0 0 1-.14-.17c-1.13-1.43-1.31-3.48-.55-5.12C5.78 10 4.87 12.3 5 14.47c.06.5.12 1 .29 1.5.14.6.41 1.2.71 1.73 1.08 1.73 2.95 2.97 4.96 3.22 2.14.27 4.43-.12 6.07-1.6 1.83-1.66 2.47-4.32 1.53-6.6l-.13-.26c-.21-.46-.77-1.26-.77-1.26m-3.16 6.3c-.28.24-.74.5-1.1.6-1.12.4-2.24-.16-2.9-.82 1.19-.28 1.9-1.16 2.11-2.05.17-.8-.15-1.46-.28-2.23-.12-.74-.1-1.37.17-2.06.19.38.39.76.63 1.06.77 1 1.98 1.44 2.24 2.8.04.14.06.28.06.43.03.82-.33 1.72-.93 2.27Z"/></svg></span></a></span><span class="mdx-badge__text">Improvement</span></span> Faster <abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr> image building<a class="headerlink" href="#improvement-faster-docker-image-building" title="Permanent link">&para;</a></h3>
<p>We now utilize <a href="https://docs.docker.com/build/buildkit/">BuildKit</a>, <a href="https://docs.docker.com/build/cache/backends/">layer caching</a>, <a href="https://docs.docker.com/build/building/multi-stage/">multi-stage</a>, and <a href="https://docs.docker.com/build/building/multi-platform/">multi-platform</a> to <em>really</em> speed up the building of <abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr> images.</p>
<p>Under ideal conditions, a <code>docker compose build</code> can now complete in less than a minute for most <abbr title="The programming language Pixelfed is written in">PHP</abbr> changes. This of course also improve the speed of building <abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr> images in GitHub Actions and CI!</p>
<h3 id="improvement-fork-friendly-docker-releasing"><span class="mdx-badge mdx-badge--improvement"><span class="mdx-badge__icon"><a href="../../conventions/" title="Improvement"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17.66 11.2c-.23-.3-.51-.56-.77-.82-.67-.6-1.43-1.03-2.07-1.66C13.33 7.26 13 4.85 13.95 3c-.95.23-1.78.75-2.49 1.32-2.59 2.08-3.61 5.75-2.39 8.9.04.1.08.2.08.33 0 .22-.15.42-.35.5-.23.1-.47.04-.66-.12a.58.58 0 0 1-.14-.17c-1.13-1.43-1.31-3.48-.55-5.12C5.78 10 4.87 12.3 5 14.47c.06.5.12 1 .29 1.5.14.6.41 1.2.71 1.73 1.08 1.73 2.95 2.97 4.96 3.22 2.14.27 4.43-.12 6.07-1.6 1.83-1.66 2.47-4.32 1.53-6.6l-.13-.26c-.21-.46-.77-1.26-.77-1.26m-3.16 6.3c-.28.24-.74.5-1.1.6-1.12.4-2.24-.16-2.9-.82 1.19-.28 1.9-1.16 2.11-2.05.17-.8-.15-1.46-.28-2.23-.12-.74-.1-1.37.17-2.06.19.38.39.76.63 1.06.77 1 1.98 1.44 2.24 2.8.04.14.06.28.06.43.03.82-.33 1.72-.93 2.27Z"/></svg></span></a></span><span class="mdx-badge__text">Improvement</span></span> Fork friendly <abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr> releasing<a class="headerlink" href="#improvement-fork-friendly-docker-releasing" title="Permanent link">&para;</a></h3>
<p>Forks of Pixelfed that have enabled GitHub Actions should <em>automatically</em> have the same <abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr> build + push experience as pixelfed/pixelfed have.</p>
<p>The <code>docker</code> workflow will by default build + push to the GitHub Container Registry for the project the commit was made to, meaning any downstream projects will not have to fork or modify their <code>docker</code> workflow to have a reliable release proccess.</p>
<p>Forks can further more set GitHub Actions Project variables <code>DOCKER_HUB_USERNAME</code>, <code>DOCKER_HUB_ORGANISATION</code>, <code>DOCKER_HUB_REPO</code> and <code>DOCKER_HUB_TOKEN</code> for automatic pushing of images to <abbr title="Docker Hub is the world's easiest way to create, manage, and deliver your team's container applications.">Docker Hub</abbr> as well. Please see the <code>.github/workflows/docker.yml</code> file for more information.</p>
<h2 id="migration-steps">Migration steps<a class="headerlink" href="#migration-steps" title="Permanent link">&para;</a></h2>
<div class="admonition info">
<p class="admonition-title">This is a best-effort guide to help migrate off the old system. The operation is potentially complicated (and risky), so please be careful!</p>
</div>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p><strong><em>PLEASE MAKE SURE TO BACKUP YOUR SERVER AND DATA BEFORE ATTEMPTING A MIGRATION</em></strong></p>
<p><strong>YOUR INSTANCE WILL BE <em>DOWN</em> WHILE DOING THE MIGRATION; PLEASE PLAN ACCORDINGLY; DEPENDING ON DATA SIZE IT COULD TAKE ANYWHERE FROM 5 <em>MINUTES</em> TO 5 <em>HOURS</em></strong></p>
</div>
<h3 id="1-backup">1) Backup<a class="headerlink" href="#1-backup" title="Permanent link">&para;</a></h3>
<ol>
<li>Make sure to back up your server (ideally <em>after</em> step 1 below has been completed, but <em>before</em> is better than not at all!)</li>
<li>Capture the current Git version / Pixelfed release you are on (e.g., <code>git --no-pager log -1</code> outputs the commit reference as the 2<sup>nd</sup> word in the first line)</li>
<li>Backup your <code>.env</code> file (we will do this in step 3 as well)</li>
<li>Backup your <code>docker-compose.yml</code> file (<code>cp docker-compose.yml docker-compose.yml.old</code>)</li>
<li>Read through the <em>entire</em> document before starting</li>
</ol>
<h3 id="2-migrate-env-file">2) Migrate <code>.env</code> file<a class="headerlink" href="#2-migrate-env-file" title="Permanent link">&para;</a></h3>
<p>The new <code>.env</code> file for <abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr> is a bit different from the old one (many new settings!) so the easiest is to grab the new <code>.env.docker</code> file and modify it from scratch again.</p>
<div class="language-bash highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>cp<span class="w"> </span>.env<span class="w"> </span>.env.old
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>wget<span class="w"> </span>-O<span class="w"> </span>.env.new<span class="w"> </span>https://raw.githubusercontent.com/jippi/pixelfed/jippi-fork/.env.docker
</code></pre></div>
<p>Then open your old <code>.env.old</code> configuration file, and for each of the key/value pairs within it, find and update the key in the new <code>.env.new</code> configuration file.</p>
<p>Don't worry, though; the file might <em>look</em> different (and significantly larger), but it behaves <em>exactly</em> the way the old file did; it just has way more options!</p>
<div class="admonition tip">
<p class="admonition-title">Don't worry if a key is missing in <code>.env.new</code>; you can add those key/value pairs back to the new file - ideally in the <code>Other configuration</code> section near the end of the file - but anywhere <em>should</em> be fine.</p>
</div>
<p>This is a great time to review your settings and familiarize yourself with all the new ones.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>In <em>particular</em> the following sections</p>
<ul>
<li><code>PHP configuration</code> section (near the end of the file) where</li>
<li>The <code>DOCKER_APP_PHP_VERSION</code> settings control your <abbr title="The programming language Pixelfed is written in">PHP</abbr> version</li>
<li>The <code>PHP_MEMORY_LIMIT</code> settings control your <abbr title="The programming language Pixelfed is written in">PHP</abbr> memory limit</li>
<li><code>Docker Specific configuration</code> section (near the end of the file) where</li>
<li>The <code>DOCKER_ALL_HOST_DATA_ROOT_PATH</code> setting dictates where the newly migrated data will live.</li>
<li>The <code>DOCKER_APP_RUN_ONE_TIME_SETUP_TASKS</code> controls whether the <code>One-time setup tasks</code> should run. We do <em>not</em> want this since your Pixelfed instance is already set up!</li>
<li><a href="../../customize/faq/">Frequently Asked Question / FAQ</a></li>
<li><a href="../../customize/faq/#how-do-i-use-my-own-proxy-server">How do I use my own Proxy server?</a></li>
<li><a href="../../customize/faq/#how-do-i-use-my-own-ssl-certificate">How do I use my own SSL certificate?</a></li>
</ul>
</div>
<h3 id="3-stop-containers">3) Stop containers<a class="headerlink" href="#3-stop-containers" title="Permanent link">&para;</a></h3>
<div class="admonition warning">
<p class="admonition-title">This will take your Pixelfed instance offline</p>
</div>
<p>Stop <em>all</em> running containers (web, worker, redis, db)</p>
<div class="language-bash highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>down
</code></pre></div>
<h3 id="4-update-source-code">4) Update source code<a class="headerlink" href="#4-update-source-code" title="Permanent link">&para;</a></h3>
<p>Update your project to the latest release of Pixelfed by running:</p>
<div class="language-bash highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>git<span class="w"> </span>pull<span class="w"> </span>origin<span class="w"> </span><span class="nv">$release</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">The <code>$release</code> can be any valid git reference like <code>dev,</code> <code>staging</code>, or a <a href="https://github.com/pixelfed/pixelfed/releases">tagged release</a> such as <code>v0.12.0</code>.</p>
</div>
<h3 id="5-migrate-data">5) Migrate data<a class="headerlink" href="#5-migrate-data" title="Permanent link">&para;</a></h3>
<p>The migration guide temporarily branches into two paths here:</p>
<ul>
<li><a href="#a-anonymous-volumes"><strong>Path A</strong></a> if you used <abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr> Anonymous Volumes.</li>
<li><a href="#b-bindhost-volumes"><strong>Path B</strong></a> if you used host/bind volumes.</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Which <abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr> volume type am I using?</p>
<p>If your old <code>docker-compose.yml</code> had a <code>volumes</code> configuration section like below, you used should follow <a href="#a-anonymous-volumes">Path A</a>.</p>
<p>This is also what the v1 <code>docker-compose.yml</code> file for pixelfed/pixelfed used.</p>
<div class="language-yaml highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="nt">db-data</span><span class="p">:</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="nt">redis-data</span><span class="p">:</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="nt">app-storage</span><span class="p">:</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="nt">app-bootstrap</span><span class="p">:</span>
</code></pre></div>
</div>
<h4 id="a-anonymous-volumes">A) Anonymous volumes<a class="headerlink" href="#a-anonymous-volumes" title="Permanent link">&para;</a></h4>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>It's important to note that this is a <em>copy</em> operation - so disk usage will (temporarily) double while you migrate</strong></p>
<p>We provide a "migration container" for your convenience that can access both the new and old volumes, allowing you to copy the data into the setup.</p>
<p>You can use <code>mv</code> (move files) instead of <code>rsync</code> in the guide below - but this is a be a <em>destructive</em> action, so you can't quickly roll back to your old setup, as the data no longer exists in the anonymous <abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr> volumes.</p>
</div>
<h5 id="a1-run-migration-container">A1) Run migration container<a class="headerlink" href="#a1-run-migration-container" title="Permanent link">&para;</a></h5>
<p>You can access the <abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr> container with both old and new volumes by running the following command:</p>
<div class="language-bash highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.migrate.yml<span class="w"> </span>run<span class="w"> </span>migrate<span class="w"> </span>bash
</code></pre></div>
<p>This will put you in the <code>/migrate</code> directory within the container, containing 9 directories like shown here:</p>
<div class="language-text highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>|-- app-storage
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>|   |-- new
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>|   `-- old
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>|-- db-data
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>|   |-- new
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>|   `-- old
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>`-- redis-data
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>    |-- new
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>    `-- old
</code></pre></div>
<h5 id="a2-check-old-folders">A2) Check old folders<a class="headerlink" href="#a2-check-old-folders" title="Permanent link">&para;</a></h5>
<p>First thing we want to do is to check if the data inside the container looks correct!</p>
<p>The following commands should all return <em>SOME</em> files and data - if they do not - then there might be an issue with the anonymous volume binding.</p>
<div class="admonition info">
<p class="admonition-title">The content of the old folders may not be <em>exactly</em> whats show in the examples below - if a couple of the files or folders match, it's extremely likely it's correct!</p>
</div>
<div class="language-bash highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>$<span class="w"> </span>ls<span class="w"> </span>app-storage/old
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>app<span class="w">  </span>debugbar<span class="w">  </span>docker<span class="w">  </span>framework<span class="w">  </span>logs
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>oauth-private.key<span class="w">  </span>oauth-public.key<span class="w">  </span>purify
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="c1"># Redis data might also be entirely empty, thats *okay*</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>$<span class="w"> </span>ls<span class="w"> </span>redis-data/old
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>appendonlydir<span class="w"> </span>server.pid
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>$<span class="w"> </span>ls<span class="w"> </span>db-data/old
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>aria_log_control<span class="w">  </span>ddl_recovery-backup.log<span class="w">  </span>ib_buffer_pool<span class="w">  </span>ib_logfile0
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>ibdata1<span class="w">  </span>mariadb_upgrade_info<span class="w">  </span>multi-master.info<span class="w">  </span>mysql
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>performance_schema<span class="w">  </span>pixelfed_prod<span class="w">  </span>sys<span class="w">  </span>undo001<span class="w">  </span>undo002<span class="w">  </span>undo003
</code></pre></div>
<h5 id="a3-check-new-folders">A3) Check new folders<a class="headerlink" href="#a3-check-new-folders" title="Permanent link">&para;</a></h5>
<p>The following commands should all return <em>NO</em> files and data - if they contain data - you need to delete it (backup first!) or skip that migration step.</p>
<p>If you haven't run <code>docker compose up</code> since you updated your project in step (2) - they should be empty and good to go.</p>
<div class="language-bash highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>ls<span class="w"> </span>app-storage/new
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>ls<span class="w"> </span>db-data/new
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>ls<span class="w"> </span>redis-data/new
</code></pre></div>
<h5 id="a4-copy-data">A4) Copy data<a class="headerlink" href="#a4-copy-data" title="Permanent link">&para;</a></h5>
<div class="admonition warning">
<p class="admonition-title">This is where we potentially will double your disk usage (temporarily)</p>
</div>
<p>Now we will copy the data from the old volumes to the new ones.</p>
<p>The migration container has <a href="https://www.digitalocean.com/community/tutorials/how-to-use-rsync-to-sync-local-and-remote-directories"><code>rsync</code></a> installed - which is perfect for that kind of work!</p>
<p><strong>NOTE</strong> It's important that the "source" (first path in the <code>rsync</code> command) has a trailing <code>/</code> - otherwise, the directory layout will turn out wrong!</p>
<p><strong>NOTE</strong> Depending on your server, these commands might take some time to finish; each command should provide a progress bar with a rough time estimation.</p>
<p><strong>NOTE</strong> <code>rsync</code> should preserve ownership, permissions, and symlinks correctly for you and all the files copied.</p>
<p>Let's copy the data by running the following commands:</p>
<div class="language-bash highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>rsync<span class="w"> </span>-avP<span class="w"> </span>app-storage/old/<span class="w"> </span>app-storage/new
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>rsync<span class="w"> </span>-avP<span class="w"> </span>db-data/old/<span class="w"> </span>db-data/new
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>rsync<span class="w"> </span>-avP<span class="w"> </span>redis-data/old/<span class="w"> </span>redis-data/new
</code></pre></div>
<h5 id="a5-sanity-checking">A5) Sanity checking<a class="headerlink" href="#a5-sanity-checking" title="Permanent link">&para;</a></h5>
<p>Let's make sure everything is copied over successfully!</p>
<p>Each <em>new</em> directory should contain <em>something</em> like (but not always exactly) the following - <strong>NO</strong> directory should have a single folder called <code>old</code>; if they do, the <code>rsync</code> commands above didn't work correctly - and you need to move the content of the <code>old</code> folder into the "root" of the <code>new</code> folder like shown a bit in the following sections.</p>
<p>The <strong>redis-data/new</strong> directory might also contain a <code>server.pid</code></p>
<div class="language-bash highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>$<span class="w"> </span>ls<span class="w"> </span>redis-data/new
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>appendonlydir
</code></pre></div>
<p>The <strong>app-storage/new</strong> directory should look <em>something</em> like this</p>
<div class="language-bash highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>$<span class="w"> </span>ls<span class="w"> </span>app-storage/new
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>app<span class="w">  </span>debugbar<span class="w">  </span>docker<span class="w">  </span>framework<span class="w">  </span>logs<span class="w">  </span>oauth-private.key<span class="w">  </span>oauth-public.key<span class="w">  </span>purify
</code></pre></div>
<p>The <strong>db-data/new</strong> directory should look <em>something</em> like this. There might be a lot of files or very few files, but there <em>must</em> be a <code>mysql</code>, <code>performance_schema</code>, and <code>${DB_DATABASE}</code> (e.g., <code>pixelfed_prod</code> directory)</p>
<div class="language-bash highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>$<span class="w"> </span>ls<span class="w"> </span>db-data/new
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>aria_log_control<span class="w">  </span>ddl_recovery-backup.log<span class="w">  </span>ib_buffer_pool<span class="w">  </span>ib_logfile0<span class="w">  </span>ibdata1<span class="w">  </span>mariadb_upgrade_info<span class="w">  </span>multi-master.info<span class="w">  </span>mysql<span class="w">  </span>performance_schema<span class="w">  </span>pixelfed_prod<span class="w">  </span>sys<span class="w">  </span>undo001<span class="w">  </span>undo002<span class="w">  </span>undo003
</code></pre></div>
<p>If everything looks good, type <code>exit</code> to leave the migration container.</p>
<h4 id="b-bindhost-volumes">B) Bind/Host volumes<a class="headerlink" href="#b-bindhost-volumes" title="Permanent link">&para;</a></h4>
<p>If you used Bind/Host volumes, then this guide can't offer any hard step-by-step guide to move your data, but instead will let you know how things would look if you started from scratch, so you can mirror or change this behavior.</p>
<p>In your <code>.env</code> file, the following KEY/VALUE pairs controls where your data and config files will go - please review each and make sure your files are in these paths, or adjust them to fit your current layout.</p>
<div class="admonition tip">
<p class="admonition-title">You can see in the <code>docker-compose.yml</code> file for each <code>service volume</code> section how they are used.</p>
</div>
<ul>
<li><code>DOCKER_ALL_HOST_DATA_ROOT_PATH</code> - The "root" path for all service data.</li>
</ul>
<p>Default: <code>./docker-compose-state/data</code></p>
<ul>
<li><code>DOCKER_ALL_HOST_CONFIG_ROOT_PATH</code> - The "root" path for all service configs.</li>
</ul>
<p>Default: <code>./docker-compose-state/config</code></p>
<ul>
<li><code>DOCKER_APP_HOST_STORAGE_PATH</code> (<code>/var/www/storage</code>) - Path for Pixelfed <code>storage</code>, e.x., uploads by users, emojis, and such</li>
</ul>
<p>Default: <code>${DOCKER_ALL_HOST_DATA_ROOT_PATH}/pixelfed/storage</code></p>
<ul>
<li><code>DOCKER_APP_HOST_CACHE_PATH</code> (<code>/var/www/bootstrap/cache</code>)</li>
</ul>
<p>Path for Pixelfed <code>bootstrap/cache</code> data.</p>
<p>Default: <code>${DOCKER_ALL_HOST_DATA_ROOT_PATH}/pixelfed/cache</code></p>
<ul>
<li><code>DOCKER_REDIS_HOST_DATA_PATH</code></li>
</ul>
<p>Path where <code>Redis</code> will store it's data.</p>
<p>Default: <code>${DOCKER_ALL_HOST_DATA_ROOT_PATH}/redis</code></p>
<ul>
<li><code>DOCKER_DB_HOST_DATA_PATH</code></li>
</ul>
<p>Path where your database (<code>MariaDB</code>) store it's data.</p>
<p>Default: <code>${DOCKER_ALL_HOST_DATA_ROOT_PATH}/db</code></p>
<h3 id="6-start-containers">6) Start containers<a class="headerlink" href="#6-start-containers" title="Permanent link">&para;</a></h3>
<p>With all an updated Pixelfed (step 2), updated <code>.env</code> file (step 3), and migrated data (steps 4, 5, 6, and 7), we're ready to start things back up again.</p>
<p>But before we start your Pixelfed server, let's put the new <code>.env</code> file we made in step 1 in its proper place.</p>
<div class="language-bash highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>cp<span class="w"> </span>.env.new<span class="w"> </span>.env
</code></pre></div>
<h4 id="the-database">The Database<a class="headerlink" href="#the-database" title="Permanent link">&para;</a></h4>
<p>The first thing we want to try is to start up the database by running the following command and checking the logs:</p>
<div class="language-bash highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>db
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>docker<span class="w"> </span>compose<span class="w"> </span>logs<span class="w"> </span>--tail<span class="w"> </span><span class="m">250</span><span class="w"> </span>--follow<span class="w"> </span>db
</code></pre></div>
<p>If there are no errors and the server isn't crashing, great! If you have an easy way of connecting to the database via a GUI or CLI client, do that as well and verify the database and tables are all there.</p>
<h4 id="redis">Redis<a class="headerlink" href="#redis" title="Permanent link">&para;</a></h4>
<p>The next thing we want to try is to start up the Redis server by running the following command and checking the logs:</p>
<div class="language-bash highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>redis
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>docker<span class="w"> </span>compose<span class="w"> </span>logs<span class="w"> </span>--tail<span class="w"> </span><span class="m">250</span><span class="w"> </span>--follow<span class="w"> </span>redis
</code></pre></div>
<p>if there are no errors and the server isn't crashing, great!</p>
<h4 id="worker">Worker<a class="headerlink" href="#worker" title="Permanent link">&para;</a></h4>
<p>The next thing we want to try is to start up the Worker server by running the following command and checking the logs:</p>
<div class="language-bash highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>worker
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>docker<span class="w"> </span>compose<span class="w"> </span>logs<span class="w"> </span>--tail<span class="w"> </span><span class="m">250</span><span class="w"> </span>--follow<span class="w"> </span>worker
</code></pre></div>
<p>The container should output a <em>lot</em> of logs from the <a href="../../customize/entrypoint/#run-script-on-startup-entrypoint">docker-entrypoint system</a>, but <em>eventually</em> you should see these messages</p>
<ul>
<li><code>Configuration complete; ready for start up</code></li>
<li><code>Horizon started successfully.</code></li>
</ul>
<p>If you see one or both of those messages, the worker seems to be running.</p>
<p>If the worker is crash looping, inspect the logs and try to resolve the issues.</p>
<p>You can consider the following additional steps:</p>
<ul>
<li>Enabling <code>DOCKER_APP_ENTRYPOINT_DEBUG</code>, which will show even more log output to help understand what is going on</li>
<li>Enabling <code>DOCKER_APP_ENSURE_OWNERSHIP_PATHS</code> against the path(s) that might have permission issues</li>
<li>Fixing permission issues directly on the host since your data should all be in the <code>${DOCKER_ALL_HOST_DATA_ROOT_PATH}</code> folder (<code>./docker-compose-state/data</code> by default)</li>
</ul>
<h4 id="web">Web<a class="headerlink" href="#web" title="Permanent link">&para;</a></h4>
<p>The final service, <code>web,</code> will bring your site back online! What a journey it has been.</p>
<p>Let's get to it: run these commands to start the <code>web</code> service and inspect the logs.</p>
<div class="language-bash highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>web
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>docker<span class="w"> </span>compose<span class="w"> </span>logs<span class="w"> </span>--tail<span class="w"> </span><span class="m">250</span><span class="w"> </span>--follow<span class="w"> </span>web
</code></pre></div>
<p>The output should be identical to that of the <code>worker</code>, so please see that section for debugging tips if the container is crash looping.</p>
<p>If the <code>web</code> service comes online without issues, start the rest of the (optional) services, such as the <code>proxy</code>, if enabled, by running:</p>
<div class="language-bash highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>docker<span class="w"> </span>compose<span class="w"> </span>logs<span class="w"> </span>--tail<span class="w"> </span><span class="m">250</span><span class="w"> </span>--follow
</code></pre></div>
<p>If you changed anything in the <code>.env</code> file while debugging, some containers might restart now; that's perfectly fine.</p>
<h3 id="7-verify">7) Verify<a class="headerlink" href="#7-verify" title="Permanent link">&para;</a></h3>
<p>With all services online, it's time to go to your browser and check everything is working.</p>
<ol>
<li>Upload and post a picture</li>
<li>Comment on a post</li>
<li>Like a post</li>
<li>Check Horizon (<code>https://${APP_DOMAIN}/horizon</code>) for any errors</li>
<li>Check the <abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr> compose logs via <code>docker compose logs --follow</code></li>
</ol>
<p>If everything looks fine, yay, you made it to the end! Let us do some cleanup</p>
<h3 id="8-cleanup">8) Cleanup<a class="headerlink" href="#8-cleanup" title="Permanent link">&para;</a></h3>
<p>With everything working, please take a new snapshot/backup of your server <em>before</em> we do any cleanup. A post-migration snapshot is handy since it contains both the old and new configuration + data, making any recovery much easier in a rollback scenario later.</p>
<p>Now, with all the data in the new folders, you can delete the old <abbr title="Docker is a set of platform as a service products that use OS-level virtualization to deliver software in packages called containers">Docker</abbr> Container volumes (if you want, completely optional)</p>
<p>List all volumes and give them a look:</p>
<div class="language-bash highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>docker<span class="w"> </span>volume<span class="w"> </span>ls
</code></pre></div>
<p>The volumes we want to delete <em>end</em> with the volume name (<code>db-data</code>, <code>app-storage</code>, <code>redis-data</code>, and <code>app-bootstrap</code>.) but have some prefixes in front of them.</p>
<p>Once you have found the volumes in in the list, delete each of them by running:</p>
<div class="language-bash highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>docker<span class="w"> </span>volume<span class="w"> </span>rm<span class="w"> </span><span class="nv">$volume_name_in_column_two_of_the_output</span>
</code></pre></div>
<p>You can also delete the <code>docker-compose.yml.old</code> and <code>.env.old</code> files since they are no longer needed:</p>
<div class="language-bash highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>rm<span class="w"> </span>docker-compose.yml.old
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>rm<span class="w"> </span>.env.old
</code></pre></div>
<h2 id="rollback">Rollback<a class="headerlink" href="#rollback" title="Permanent link">&para;</a></h2>
<p>Oh no, something went wrong? No worries; you have backups and a quick way back!</p>
<h3 id="move-docker-composeyml-back">Move <code>docker-compose.yml</code> back<a class="headerlink" href="#move-docker-composeyml-back" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>cp<span class="w"> </span>docker-compose.yml<span class="w"> </span>docker-compose.yml.new
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>cp<span class="w"> </span>docker-compose.yml.old<span class="w"> </span>docker-compose.yml
</code></pre></div>
<h3 id="move-env-file-back">Move <code>.env</code> file back<a class="headerlink" href="#move-env-file-back" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>cp<span class="w"> </span>env.old<span class="w"> </span>.env
</code></pre></div>
<h3 id="go-back-to-the-old-source-code-version">Go back to the old source code version<a class="headerlink" href="#go-back-to-the-old-source-code-version" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>git<span class="w"> </span>checkout<span class="w"> </span><span class="nv">$commit_id_from_step_0</span>
</code></pre></div>
<h3 id="start-things-back-up">Start things back up<a class="headerlink" href="#start-things-back-up" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d
</code></pre></div>
<h3 id="verify-it-worked">Verify it worked<a class="headerlink" href="#verify-it-worked" title="Permanent link">&para;</a></h3>
<p>See <a href="#7-verify">Step 7</a> for recommended steps to verify everythin is working</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.tooltips", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "navigation.expand", "navigation.instant", "navigation.sections", "navigation.top", "navigation.tracking", "toc.follow"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.af256bd8.min.js"></script>
      
    
  </body>
</html>